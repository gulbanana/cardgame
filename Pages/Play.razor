@page "/play"
@inject NavigationManager Navigation
@inject IGameEndpoint Endpoint
@inject IUserSession Session
@code {
    private GameModel currentModel;

    protected override void OnInitialized()
    {
        if (!Session.IsLoggedIn)
        {
#if DEBUG
            Session.Login("guest");
#else
            Navigation.NavigateTo("/");
#endif            
        }

        currentModel = Endpoint.Subscribe(OnUpdate);
    }

    private void OnUpdate(GameModel newModel)
    {
        InvokeAsync(() =>
        {
            currentModel = newModel;
            StateHasChanged();
        });
    }

    private void DoExecute(ClientCommand command)
    {
        var error = Endpoint.Execute(Session.Username, command);

        if (error != null)
        {
            Console.WriteLine(error);
        }
    }
}

<CascadingValue Value="@(new Executor(DoExecute))">
    <GameView Model="currentModel" />
</CascadingValue>