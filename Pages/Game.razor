@page "/game/{GameName}"
@attribute [Authorize]
@inject NavigationManager Navigation
@inject IGameEndpoint Endpoint
@inject IUserSession Session
@code {
    [Parameter] public string GameName { get; set; }
    private IGame game;
    private GameModel currentModel;

    protected override void OnInitialized()
    {
        game = Endpoint.FindGame(GameName);
        currentModel = game.Subscribe(OnUpdate);
    }


    private void OnUpdate(GameModel newModel)
    {
        InvokeAsync(() =>
        {
            currentModel = newModel;
            StateHasChanged();
        });
    }

    private void DoExecute(ClientCommand command)
    {
        command.Seq = currentModel.Seq;
        var error = game.Execute(Session.Username, command);

        if (error != null)
        {
            Console.WriteLine(error);

            game.Unsubscribe(OnUpdate);
            currentModel = game.Subscribe(OnUpdate);
        }
    }
}

<CascadingValue Value="@(new Executor(DoExecute))">
    <GameView Model="currentModel" />
</CascadingValue>